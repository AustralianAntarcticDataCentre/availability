<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulating tracks with the availability package • availability</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simulating tracks with the availability package">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">availability</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.13.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/availability.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/AustralianAntarcticDataCentre/availability">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Simulating tracks with the availability package</h1>
                        <h4 class="author">Ben Raymond, Simon Wotherspoon, Ian Jonsen, Ryan Reisinger</h4>
            
            <h4 class="date">2018-11-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/AustralianAntarcticDataCentre/availability/blob/master/vignettes/availability.Rmd"><code>vignettes/availability.Rmd</code></a></small>
      <div class="hidden name"><code>availability.Rmd</code></div>

    </div>

    
    
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p>This package provides methods for estimating the geographic space available to an animal, based on an observed track collected by a GPS tag or similar. Broadly, these functions generate a simulated track that preserves certain properties of the original track. The simulated tracks can optionally be constrained by a land mask (or other mask that prevents the simulated track from visiting unwanted locations). It can also be forced to pass through fixed points at certain times, allowing (for example) simulated tracks to finish at the same point from which they started.</p>
<p>The simulated tracks only attempt to preserve basic properties of the observed track, such as the speeds exhibited by the animal and the overall track duration. The intention is not to explicitly reproduce behavioural states such as area-restricted searching. Rather, the goal is to estimate a plausible track that the animal might have produced, if it did not have any environmental or other preferences governing its movements. The geographic and environmental properties of the actual track can then be compared to those of simulated tracks, giving insights into the preferred habitats of the animal.</p>
<p>For application examples, see e.g. Raymond et al. (2015), Reisinger et al. (2018), Courbin et al. (2018), and Péron et al. (2018).</p>
</div>
<div id="usage-examples" class="section level1">
<h1 class="hasAnchor">
<a href="#usage-examples" class="anchor"></a>Usage examples</h1>
<p>Load the availability package, and some others that we’ll use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(availability)
<span class="kw">library</span>(argosfilter)
<span class="kw">library</span>(crawl)
<span class="kw">library</span>(geosphere)
<span class="kw">library</span>(ggplot2)
<span class="kw">set.seed</span>(<span class="dv">28</span>)
cpal &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"#1B9E77"</span>, <span class="st">"#D95F02"</span>, <span class="st">"#7570B3"</span>, <span class="st">"#E7298A"</span>, <span class="st">"#66A61E"</span>, <span class="st">"#E6AB02"</span>)</code></pre></div>
<p>Some helper functions used in this demo:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## helper function to fit a crawl model to PTT data
fit_crawl &lt;-<span class="st"> </span><span class="cf">function</span>(d, <span class="dt">tstep =</span> <span class="dv">3</span>, <span class="dt">smaxit =</span> <span class="dv">100</span>, <span class="dt">attempts =</span> <span class="dv">10</span>) {
    argos_errors &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">location_quality =</span> <span class="kw">c</span>(<span class="st">"3"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>, <span class="st">"0"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>),
                              <span class="dt">errX =</span> <span class="kw">log</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">4</span>, <span class="dv">14</span>, <span class="fl">5.21</span>, <span class="fl">20.78</span>)),
                              <span class="dt">errY =</span> <span class="kw">log</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">4</span>, <span class="dv">14</span>, <span class="fl">11.08</span>, <span class="fl">31.03</span>)))

    ## merge argos error information into d
    d &lt;-<span class="st"> </span><span class="kw">merge</span>(d, argos_errors)

    ## ensure time-ordering
    d &lt;-<span class="st"> </span>d[<span class="kw">order</span>(d<span class="op">$</span>date), ]

    ## apply an initial speed filter
    d<span class="op">$</span>filt &lt;-<span class="st"> </span><span class="kw">sdafilter</span>(<span class="dt">lat =</span> d<span class="op">$</span>decimal_latitude, <span class="dt">lon =</span> d<span class="op">$</span>decimal_longitude, <span class="dt">dtime =</span> d<span class="op">$</span>date,
                        <span class="dt">lc =</span> d<span class="op">$</span>location_quality, <span class="dt">vmax =</span> <span class="dv">5</span>, <span class="dt">ang =</span> <span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">25</span>),
                        <span class="dt">distlim =</span> <span class="kw">c</span>(<span class="dv">2500</span>, <span class="dv">5000</span>))
    d &lt;-<span class="st"> </span>d[d<span class="op">$</span>filt <span class="op">!=</span><span class="st"> "removed"</span>, ]

    initial.state &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a1.x =</span> <span class="kw">c</span>(d<span class="op">$</span>decimal_longitude[<span class="dv">1</span>], <span class="dv">0</span>),
                          <span class="dt">a1.y =</span> <span class="kw">c</span>(d<span class="op">$</span>decimal_latitude[<span class="dv">1</span>], <span class="dv">0</span>),
                          <span class="dt">P1.x =</span> <span class="kw">diag</span>(<span class="kw">c</span>(<span class="fl">0.001</span>, <span class="fl">0.001</span>)), <span class="dt">P1.y =</span> <span class="kw">diag</span>(<span class="kw">c</span>(<span class="fl">0.001</span>, <span class="fl">0.001</span>)))

    ## Repeatedly attempt to fit model.
    fit &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">data =</span> d, <span class="dt">fn.args =</span> <span class="kw">list</span>(<span class="dt">tstep =</span> tstep, <span class="dt">smaxit =</span> smaxit, <span class="dt">attempts =</span> attempts))
    <span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_len</span>(attempts)) {
        fit<span class="op">$</span>crawl &lt;-<span class="st"> </span><span class="kw">try</span>(<span class="kw">crwMLE</span>(<span class="dt">mov.model =</span> <span class="op">~</span><span class="dv">1</span>, <span class="dt">err.model =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="op">~</span>errX, <span class="dt">y =</span> <span class="op">~</span>errY),
                                <span class="dt">stop.model =</span> <span class="op">~</span>land, <span class="dt">data =</span> d,
                                <span class="dt">coord =</span> <span class="kw">c</span>(<span class="st">"decimal_longitude"</span>, <span class="st">"decimal_latitude"</span>),
                                <span class="dt">polar.coord =</span> <span class="ot">FALSE</span>, <span class="dt">Time.name =</span> <span class="st">"date"</span>,
                                <span class="dt">initial.state =</span> initial.state, <span class="dt">initialSANN =</span> <span class="kw">list</span>(<span class="dt">maxit =</span> smaxit)),
                         <span class="dt">silent =</span> <span class="ot">TRUE</span>)
        <span class="cf">if</span>(<span class="op">!</span><span class="kw">inherits</span>(fit<span class="op">$</span>crawl, <span class="st">"try-error"</span>)) <span class="cf">break</span>
    }
    <span class="cf">if</span>(<span class="kw">inherits</span>(fit<span class="op">$</span>crawl, <span class="st">"try-error"</span>)) {
        <span class="kw">stop</span>(<span class="st">"failed to fit crawl model"</span>)
    } <span class="cf">else</span> {
        ## interpolate to positions every tstep hours
        predTime &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(d<span class="op">$</span>date), <span class="kw">max</span>(d<span class="op">$</span>date), tstep<span class="op">*</span><span class="dv">3600</span>)
        predObj &lt;-<span class="st"> </span><span class="kw">crwPredict</span>(<span class="dt">object.crwFit =</span> fit<span class="op">$</span>crawl, <span class="dt">predTime =</span> predTime, <span class="dt">speedEst =</span> <span class="ot">TRUE</span>,
                              <span class="dt">flat =</span> <span class="ot">TRUE</span>)
        fit<span class="op">$</span>pred &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">date =</span> predTime, predObj[predObj<span class="op">$</span>locType <span class="op">==</span><span class="st"> "p"</span>, ])
    }
    fit
}

## this function converts the fit object returned by our crawl helper into the "template track"
## format used by the availability package routines
templateTrack &lt;-<span class="st"> </span><span class="cf">function</span>(fit) {
  pr &lt;-<span class="st"> </span>fit<span class="op">$</span>pred
  pr &lt;-<span class="st"> </span>pr[pr<span class="op">$</span>locType<span class="op">==</span><span class="st">"p"</span>, ]
  <span class="kw">list</span>(<span class="dt">ts =</span> pr<span class="op">$</span>date, <span class="dt">xs =</span> <span class="kw">as.matrix</span>(pr[, <span class="kw">c</span>(<span class="st">"mu.x"</span>, <span class="st">"mu.y"</span>, <span class="st">"nu.x"</span>, <span class="st">"nu.y"</span>)]))
}


## simple helper to plot tracks
plotTracks &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">pal =</span> cpal) {
  <span class="kw">require</span>(maptools)
  <span class="kw">data</span>(wrld_simpl)
  trks &lt;-<span class="st"> </span><span class="kw">list</span>(...)
  xlim &lt;-<span class="st"> </span><span class="kw">do.call</span>(range, <span class="kw">lapply</span>(trks, <span class="cf">function</span>(trk) trk[, <span class="dv">1</span>]))
  ylim &lt;-<span class="st"> </span><span class="kw">do.call</span>(range, <span class="kw">lapply</span>(trks, <span class="cf">function</span>(trk) trk[, <span class="dv">2</span>]))
  <span class="kw">plot</span>(xlim, ylim, <span class="dt">type =</span> <span class="st">"n"</span>, <span class="dt">xlim =</span> xlim, <span class="dt">ylim =</span> ylim, <span class="dt">xlab =</span> <span class="st">"longitude"</span>, <span class="dt">ylab =</span> <span class="st">"latitude"</span>)
  <span class="cf">for</span> (k <span class="cf">in</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">floor</span>((<span class="kw">min</span>(xlim)<span class="op">+</span><span class="dv">180</span>)<span class="op">/</span><span class="dv">360</span>), <span class="dt">to =</span> <span class="kw">floor</span>((<span class="kw">max</span>(xlim)<span class="op">+</span><span class="dv">180</span>)<span class="op">/</span><span class="dv">360</span>), <span class="dt">by =</span> <span class="dv">1</span>))
      <span class="kw">plot</span>(<span class="kw">elide</span>(wrld_simpl, <span class="dt">shift =</span> <span class="kw">c</span>(k<span class="op">*</span><span class="dv">360</span>, <span class="dv">0</span>)), <span class="dt">col =</span> <span class="st">"grey80"</span>, <span class="dt">border =</span> <span class="st">"grey80"</span>,
           <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">xlim =</span> xlim, <span class="dt">ylim =</span> ylim)
  <span class="cf">for</span>(k <span class="cf">in</span> <span class="kw">seq_along</span>(trks)) <span class="kw">lines</span>(trks[[k]], <span class="dt">col =</span> pal[k])
}</code></pre></div>
<div id="sooty-albatross" class="section level2">
<h2 class="hasAnchor">
<a href="#sooty-albatross" class="anchor"></a>Sooty Albatross</h2>
<p>The track of a sooty albatross from the Prince Edwards Islands, from Reisinger et al. (2018). First pass the data through crawl to produce a filtered track with evenly-sampled 3-hourly time steps:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(ptt_data)
time_step &lt;-<span class="st"> </span><span class="dv">3</span>
fit &lt;-<span class="st"> </span><span class="kw">fit_crawl</span>(ptt_data<span class="op">$</span>DMS, <span class="dt">tstep =</span> time_step)</code></pre></div>
<p>Extract the filtered track and show the first few rows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tp &lt;-<span class="st"> </span><span class="kw">templateTrack</span>(fit)
<span class="kw">head</span>(tp<span class="op">$</span>xs)</code></pre></div>
<pre><code>##        mu.x      mu.y       nu.x        nu.y
## 1  37.99109 -47.05000 0.46741963  0.10354427
## 4  38.63050 -47.33072 0.05225392 -0.06927612
## 10 38.71572 -47.33594 0.02977198  0.02300072
## 16 38.96142 -47.45399 0.05696371 -0.09288884
## 18 39.10650 -47.76929 0.04315302 -0.11425005
## 19 39.22747 -48.12720 0.03821439 -0.12306425</code></pre>
<p>Plot the raw (magenta) and filtered (green) versions of the track:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plotTracks</span>(ptt_data<span class="op">$</span>DMS[, <span class="kw">c</span>(<span class="st">"decimal_longitude"</span>, <span class="st">"decimal_latitude"</span>)], tp<span class="op">$</span>xs, 
           <span class="dt">pal =</span> cpal[<span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>)])</code></pre></div>
<p><img src="availability_files/figure-html/plot_dms-1.png" width="648" style="display: block; margin: auto;"></p>
<div id="simulating-a-track-by-the-var-method" class="section level3">
<h3 class="hasAnchor">
<a href="#simulating-a-track-by-the-var-method" class="anchor"></a>Simulating a track by the VAR method</h3>
<p>Fit a vector-autoregressive movement model to this filtered track. This model assumes that the x- and y-speeds at time <em>t</em> are a linear function of the speeds at time <em>t-1</em>, plus random noise.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">arfit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/surrogateARModel.html">surrogateARModel</a></span>(tp<span class="op">$</span>xs)</code></pre></div>
<p>Now we can use that fitted model to generate new tracks. By default, the end points of the simulated track are fixed to the same start and end points as the original track, and no land mask is applied:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trkar &lt;-<span class="st"> </span><span class="kw"><a href="../reference/surrogateAR.html">surrogateAR</a></span>(arfit,tp<span class="op">$</span>xs,tp<span class="op">$</span>ts)</code></pre></div>
<p>Plot the original filtered track (green), simulated track (orange), and track end points (red dots).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plotTracks</span>(tp<span class="op">$</span>xs, trkar<span class="op">$</span>xs)
<span class="kw">points</span>(tp<span class="op">$</span>xs[<span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(tp<span class="op">$</span>xs)), <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">"red"</span>)</code></pre></div>
<p><img src="availability_files/figure-html/simar_plot-1.png" width="648" style="display: block; margin: auto;"></p>
</div>
<div id="simulating-a-track-by-the-crawl-method" class="section level3">
<h3 class="hasAnchor">
<a href="#simulating-a-track-by-the-crawl-method" class="anchor"></a>Simulating a track by the crawl method</h3>
<p>Alternatively, we can use the movement model fitted by crawl to directly simulate a new track with the same movement properties:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/surrogateCrawlModel.html">surrogateCrawlModel</a></span>(fit<span class="op">$</span>crawl, <span class="dv">3</span>)
trkcrw &lt;-<span class="st"> </span><span class="kw"><a href="../reference/surrogateCrawl.html">surrogateCrawl</a></span>(model, tp<span class="op">$</span>xs, tp<span class="op">$</span>ts)
<span class="kw">plotTracks</span>(tp<span class="op">$</span>xs, trkcrw<span class="op">$</span>xs, <span class="dt">pal =</span> cpal[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)])
<span class="kw">points</span>(tp<span class="op">$</span>xs[<span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(tp<span class="op">$</span>xs)), <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">"red"</span>)</code></pre></div>
<p><img src="availability_files/figure-html/simcrawl_dms-1.png" width="648" style="display: block; margin: auto;"></p>
</div>
<div id="comparison-of-simulated-tracks-to-the-observed-track" class="section level3">
<h3 class="hasAnchor">
<a href="#comparison-of-simulated-tracks-to-the-observed-track" class="anchor"></a>Comparison of simulated tracks to the observed track</h3>
<p>The speed distributions of the three tracks can be compared directly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">step_len &lt;-<span class="st"> </span><span class="cf">function</span>(z) <span class="kw">distVincentyEllipsoid</span>(z[<span class="op">-</span><span class="kw">nrow</span>(z), <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], z[<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]) <span class="op">/</span><span class="st"> </span><span class="fl">1e3</span>
temp &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">speed =</span> <span class="kw">step_len</span>(tp<span class="op">$</span>xs) <span class="op">/</span><span class="st"> </span>time_step, <span class="dt">track =</span> <span class="st">"Observed"</span>)
temp &lt;-<span class="st"> </span><span class="kw">rbind</span>(temp, <span class="kw">data.frame</span>(<span class="dt">speed =</span> <span class="kw">step_len</span>(trkar<span class="op">$</span>xs) <span class="op">/</span><span class="st"> </span>time_step, <span class="dt">track =</span> <span class="st">"AR"</span>))
temp &lt;-<span class="st"> </span><span class="kw">rbind</span>(temp, <span class="kw">data.frame</span>(<span class="dt">speed =</span> <span class="kw">step_len</span>(trkcrw<span class="op">$</span>xs) <span class="op">/</span><span class="st"> </span>time_step, <span class="dt">track =</span> <span class="st">"Crawl"</span>))
<span class="kw">ggplot</span>(<span class="dt">data =</span> temp, <span class="kw">aes</span>(<span class="dt">x =</span> speed, <span class="dt">fill =</span> track)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_grid</span>(track<span class="op">~</span>.) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">60</span>, <span class="dt">by =</span> <span class="dv">5</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">"Speed (km/h)"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> cpal)</code></pre></div>
<p><img src="availability_files/figure-html/speed_distributions_dms-1.png" width="648" style="display: block; margin: auto;"></p>
<p>The observed track appears to have a number of segments with slow speeds (see the peak in the histogram at around 3 km/h, possibly related to area-restricted searching), superimposed on a broad distribution of speeds up to about 35 km/h. There is also a peak in the histogram at around 15 km/h, but this looks suspiciously like an artefact arising from the interpolation of the raw track positions.</p>
</div>
<div id="simulating-tracks-land-masking" class="section level3">
<h3 class="hasAnchor">
<a href="#simulating-tracks-land-masking" class="anchor"></a>Simulating tracks: land masking</h3>
<p>By default, the end points of the simulated track are fixed to the same start and end points as the original track, and no land mask is applied. A land mask can be applied via the <code>point.check</code> argument. For example, using the land mask supplied with the package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trkar &lt;-<span class="st"> </span><span class="kw"><a href="../reference/surrogateAR.html">surrogateAR</a></span>(arfit, tp<span class="op">$</span>xs, tp<span class="op">$</span>ts, <span class="dt">point.check =</span> <span class="kw"><a href="../reference/gshhsMask.html">gshhsMask</a></span>())
<span class="kw">plotTracks</span>(tp<span class="op">$</span>xs, trkar<span class="op">$</span>xs)
<span class="kw">points</span>(tp<span class="op">$</span>xs[<span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(tp<span class="op">$</span>xs)), <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">"red"</span>)</code></pre></div>
<p><img src="availability_files/figure-html/simar_mask_dms-1.png" width="648" style="display: block; margin: auto;"></p>
<p>The <code>point.check</code> argument accepts a function of the form <code>function(tm, pt)</code> that returns <code>TRUE</code> if the point should be accepted and <code>FALSE</code> if not. Note that this function can accept a time coordinate as well as a location, and so the mask can be made time-varying if required (e.g. dynamically masking out areas covered by sea ice).</p>
</div>
<div id="simulating-tracks-fixing-points" class="section level3">
<h3 class="hasAnchor">
<a href="#simulating-tracks-fixing-points" class="anchor"></a>Simulating tracks: fixing points</h3>
<p>By default, the first and last points of the simulated track are fixed to match those of the template track. These fixed points can be removed, or other fixed points enforced, via the <code>fixed</code> parameter. (For the AR method, the first point must always be fixed.)</p>
<p>Fix an additional arbitrary point on the path (indicated by the blue point on the plot):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fixed &lt;-<span class="st"> </span><span class="kw">logical</span>(<span class="kw">nrow</span>(tp<span class="op">$</span>xs))
fixed[<span class="dv">1</span>] &lt;-<span class="st"> </span>fixed[<span class="kw">nrow</span>(tp<span class="op">$</span>xs)] &lt;-<span class="st"> </span>fixed[<span class="dv">750</span>] &lt;-<span class="st"> </span><span class="ot">TRUE</span>
trkar &lt;-<span class="st"> </span><span class="kw"><a href="../reference/surrogateAR.html">surrogateAR</a></span>(arfit, tp<span class="op">$</span>xs, tp<span class="op">$</span>ts, fixed, <span class="dt">point.check =</span> <span class="kw"><a href="../reference/gshhsMask.html">gshhsMask</a></span>())
<span class="kw">plotTracks</span>(tp<span class="op">$</span>xs, trkar<span class="op">$</span>xs)
<span class="kw">points</span>(tp<span class="op">$</span>xs[<span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(tp<span class="op">$</span>xs)), <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">"red"</span>)
<span class="kw">points</span>(tp<span class="op">$</span>xs[<span class="dv">750</span>, <span class="dv">1</span>], tp<span class="op">$</span>xs[<span class="dv">750</span>, <span class="dv">2</span>], <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">"blue"</span>)</code></pre></div>
<p><img src="availability_files/figure-html/simar_fix1_dms-1.png" width="648" style="display: block; margin: auto;"></p>
<p>Repeat but do not fix final endpoint:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fixed &lt;-<span class="st"> </span><span class="kw">logical</span>(<span class="kw">nrow</span>(tp<span class="op">$</span>xs))
fixed[<span class="dv">1</span>] &lt;-<span class="st"> </span>fixed[<span class="dv">750</span>] &lt;-<span class="st"> </span><span class="ot">TRUE</span>
trkar &lt;-<span class="st"> </span><span class="kw"><a href="../reference/surrogateAR.html">surrogateAR</a></span>(arfit, tp<span class="op">$</span>xs, tp<span class="op">$</span>ts, fixed, <span class="dt">point.check =</span> <span class="kw"><a href="../reference/gshhsMask.html">gshhsMask</a></span>())
<span class="kw">plotTracks</span>(tp<span class="op">$</span>xs, trkar<span class="op">$</span>xs)
<span class="kw">points</span>(tp<span class="op">$</span>xs[<span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(tp<span class="op">$</span>xs)), <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">"red"</span>)
<span class="kw">points</span>(tp<span class="op">$</span>xs[<span class="dv">750</span>, <span class="dv">1</span>], tp<span class="op">$</span>xs[<span class="dv">750</span>, <span class="dv">2</span>], <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">"blue"</span>)</code></pre></div>
<p><img src="availability_files/figure-html/simar_fix2_dms-1.png" width="648" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="elephant-seal" class="section level2">
<h2 class="hasAnchor">
<a href="#elephant-seal" class="anchor"></a>Elephant Seal</h2>
<p>Elephant seal data from Reisinger et al. (2018).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit &lt;-<span class="st"> </span><span class="kw">fit_crawl</span>(ptt_data<span class="op">$</span>SES, <span class="dt">tstep =</span> time_step)
tp &lt;-<span class="st"> </span><span class="kw">templateTrack</span>(fit)</code></pre></div>
<p>Use the fitted model to determine parameters and generate new path fixing both ends, and using a land mask:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/surrogateCrawlModel.html">surrogateCrawlModel</a></span>(fit<span class="op">$</span>crawl, <span class="dv">3</span>)
trkcrw &lt;-<span class="st"> </span><span class="kw"><a href="../reference/surrogateCrawl.html">surrogateCrawl</a></span>(model, tp<span class="op">$</span>xs, tp<span class="op">$</span>ts, <span class="dt">point.check =</span> <span class="kw"><a href="../reference/gshhsMask.html">gshhsMask</a></span>())</code></pre></div>
<p>Also simulate using the AR method:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/surrogateARModel.html">surrogateARModel</a></span>(tp<span class="op">$</span>xs)
trkar &lt;-<span class="st"> </span><span class="kw"><a href="../reference/surrogateAR.html">surrogateAR</a></span>(model, tp<span class="op">$</span>xs, tp<span class="op">$</span>ts, <span class="dt">point.check =</span> <span class="kw"><a href="../reference/gshhsMask.html">gshhsMask</a></span>())</code></pre></div>
<p>Compare the tracks (original track in green, crawl-simulated track in orange, AR-simulated track in purplish-indigo-whatever):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plotTracks</span>(tp<span class="op">$</span>xs, trkar<span class="op">$</span>xs, trkcrw<span class="op">$</span>xs)
<span class="kw">points</span>(tp<span class="op">$</span>xs[<span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(tp<span class="op">$</span>xs)), <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">"red"</span>)</code></pre></div>
<p><img src="availability_files/figure-html/plot_es-1.png" width="648" style="display: block; margin: auto;"></p>
<p>Compare speed distributions as we did before:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">temp &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">speed =</span> <span class="kw">step_len</span>(tp<span class="op">$</span>xs) <span class="op">/</span><span class="st"> </span>time_step, <span class="dt">track =</span> <span class="st">"Observed"</span>)
temp &lt;-<span class="st"> </span><span class="kw">rbind</span>(temp, <span class="kw">data.frame</span>(<span class="dt">speed =</span> <span class="kw">step_len</span>(trkar<span class="op">$</span>xs) <span class="op">/</span><span class="st"> </span>time_step, <span class="dt">track =</span> <span class="st">"AR"</span>))
temp &lt;-<span class="st"> </span><span class="kw">rbind</span>(temp, <span class="kw">data.frame</span>(<span class="dt">speed =</span> <span class="kw">step_len</span>(trkcrw<span class="op">$</span>xs) <span class="op">/</span><span class="st"> </span>time_step, <span class="dt">track =</span> <span class="st">"Crawl"</span>))
<span class="kw">ggplot</span>(<span class="dt">data =</span> temp, <span class="kw">aes</span>(<span class="dt">x =</span> speed, <span class="dt">fill =</span> track)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_grid</span>(track<span class="op">~</span>.) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">60</span>, <span class="dt">by =</span> <span class="dv">5</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">"Speed (km/h)"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> cpal)</code></pre></div>
<p><img src="availability_files/figure-html/speed_distributions_es-1.png" width="648" style="display: block; margin: auto;"></p>
<p>In this instance the crawl-based method doesn’t do a particularly good job of reproducing the speeds of the observed track. The AR-based method similarly fails to reproduce the steeply-peaked shape of the distribution, but does produce a simulated track that is plausible in the sense that it has speeds in largely the same range as the observed track.</p>
</div>
<div id="antarctic-fur-seal" class="section level2">
<h2 class="hasAnchor">
<a href="#antarctic-fur-seal" class="anchor"></a>Antarctic Fur Seal</h2>
<p>Fur seal track from Reisinger et al. (2018).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit &lt;-<span class="st"> </span><span class="kw">fit_crawl</span>(ptt_data<span class="op">$</span>AFS, <span class="dt">tstep =</span> time_step)
tp &lt;-<span class="st"> </span><span class="kw">templateTrack</span>(fit)</code></pre></div>
<p>Simulate by both methods:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/surrogateCrawlModel.html">surrogateCrawlModel</a></span>(fit<span class="op">$</span>crawl, <span class="dv">3</span>)
trkcrw &lt;-<span class="st"> </span><span class="kw"><a href="../reference/surrogateCrawl.html">surrogateCrawl</a></span>(model, tp<span class="op">$</span>xs, tp<span class="op">$</span>ts, <span class="dt">point.check =</span> <span class="kw"><a href="../reference/gshhsMask.html">gshhsMask</a></span>())
model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/surrogateARModel.html">surrogateARModel</a></span>(tp<span class="op">$</span>xs)
trkar &lt;-<span class="st"> </span><span class="kw"><a href="../reference/surrogateAR.html">surrogateAR</a></span>(model, tp<span class="op">$</span>xs, tp<span class="op">$</span>ts, <span class="dt">point.check =</span> <span class="kw"><a href="../reference/gshhsMask.html">gshhsMask</a></span>())
<span class="kw">plotTracks</span>(tp<span class="op">$</span>xs, trkar<span class="op">$</span>xs, trkcrw<span class="op">$</span>xs)
<span class="kw">points</span>(tp<span class="op">$</span>xs[<span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(tp<span class="op">$</span>xs)), <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">"red"</span>)</code></pre></div>
<p><img src="availability_files/figure-html/sim_fs-1.png" width="648" style="display: block; margin: auto;"></p>
<p>Compare speed distributions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">temp &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">speed =</span> <span class="kw">step_len</span>(tp<span class="op">$</span>xs) <span class="op">/</span><span class="st"> </span>time_step, <span class="dt">track =</span> <span class="st">"Observed"</span>)
temp &lt;-<span class="st"> </span><span class="kw">rbind</span>(temp, <span class="kw">data.frame</span>(<span class="dt">speed =</span> <span class="kw">step_len</span>(trkar<span class="op">$</span>xs) <span class="op">/</span><span class="st"> </span>time_step, <span class="dt">track =</span> <span class="st">"AR"</span>))
temp &lt;-<span class="st"> </span><span class="kw">rbind</span>(temp, <span class="kw">data.frame</span>(<span class="dt">speed =</span> <span class="kw">step_len</span>(trkcrw<span class="op">$</span>xs) <span class="op">/</span><span class="st"> </span>time_step, <span class="dt">track =</span> <span class="st">"Crawl"</span>))
<span class="kw">ggplot</span>(<span class="dt">data =</span> temp, <span class="kw">aes</span>(<span class="dt">x =</span> speed, <span class="dt">fill =</span> track)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_grid</span>(track<span class="op">~</span>.) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">60</span>, <span class="dt">by =</span> <span class="dv">5</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">"Speed (km/h)"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> cpal)</code></pre></div>
<p><img src="availability_files/figure-html/speed_distributions_fs-1.png" width="648" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>[1] Raymond B, Lea MA, Patterson T, Andrews-Goff V, Sharples R, Charrassin J-B, Cottin M, Emmerson L, Gales N, Gales R, Goldsworthy SD, Harcourt R, Kato A, Kirkwood R, Lawton K, Ropert-Coudert Y, Southwell C, van den Hoff J, Wienecke B, Woehler EJ, Wotherspoon S, Hindell MA (2015) Important marine habitat off East Antarctica revealed by two decades of multi-species predator tracking. <em>Ecography</em>. <a href="https://doi.org/10.1111/ecog.01021">doi:10.1111/ecog.01021</a></p>
<p>[2] Reisinger RR, Raymond B, Hindell MA, Bester MN, Crawford RJM, Davies D, de Bruyn PJN, Dilley BJ, Kirkman SP, Makhado AB, Ryan PG, Schoombie S, Stevens K, Sumner MD, Tosh CA, Wege M, Whitehead TO, Wotherspoon S, Pistorius PA (2018) Habitat modelling of tracking data from multiple marine top predators reveals important habitat in the Southern Indian Ocean. <em>Diversity and Distributions</em>. <a href="https://doi.org/10.1111/ddi.12702">doi:10.1111/ddi.12702</a></p>
<p>[3] Courbin N, Besnard A, Péron C, Saraux C, Fort J, Perret S, Tornos J, Grémillet D (2018) Short-term prey field lability constrains individual specialisation in resource selection and foraging site fidelity in a marine predator. <em>Ecology Letters</em>. <a href="https://doi.org/10.1111/ele.12970">doi:10.1111/ele.12970</a></p>
<p>[4] Péron C, Authier M, Grémillet D (2018) Testing the transferability of track-based habitat models for sound marine spatial planning. <em>Diversity and Distributions</em>. <a href="https://doi.org/10.1111/ddi.12832">doi:10.1111/ddi.12832</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#background">Background</a></li>
      <li>
<a href="#usage-examples">Usage examples</a><ul class="nav nav-pills nav-stacked">
<li><a href="#sooty-albatross">Sooty Albatross</a></li>
      <li><a href="#elephant-seal">Elephant Seal</a></li>
      <li><a href="#antarctic-fur-seal">Antarctic Fur Seal</a></li>
      </ul>
</li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Ben Raymond, Simon Wotherspoon, Ian Jonsen, Ryan Reisinger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
